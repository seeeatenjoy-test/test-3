<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>SEE AR Demo</title>
	<!-- Include three.js library -->
	<script src="https://cdn.jsdelivr.net/npm/three@0.146/build/three.min.js"></script>
	<!-- Include GLTFLoader and DRACOLoader from CDN -->
	<script src="https://cdn.jsdelivr.net/npm/three@0.146/examples/js/loaders/GLTFLoader.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/three@0.146/examples/js/loaders/DRACOLoader.js"></script>
	<!-- Include jsartoolkit -->
	<script src="jsartoolkit5/artoolkit.min.js"></script>
	<script src="jsartoolkit5/artoolkit.api.js"></script>
	<!-- Include threex.artoolkit -->
	<script src="threex/threex-artoolkitsource.js"></script>
	<script src="threex/threex-artoolkitcontext.js"></script>
	<script src="threex/threex-arbasecontrols.js"></script>
	<script src="threex/threex-armarkercontrols.js"></script>
	<!-- Include Google Fonts for Markazi Text -->
	<link href="https://fonts.googleapis.com/css2?family=Markazi+Text:wght@400;500;600;700&display=swap" rel="stylesheet">
	<style>
		/* Your existing CSS styles */
	</style>
</head>
<body>
	<!-- Camera Section -->
	<div id="camera-section">
		<div id="arjs-wrapper"></div>
	</div>

	<!-- Menu Section -->
	<div id="menu-section">
		<div id="dropdown-headline">Select A Dish</div>
		<select id="dropdown-menu">
			<option value="fish">Fish</option>
			<option value="sushi">Sushi</option>
			<option value="burger">Burger</option>
		</select>

		<div id="popular-dishes-headline">Popular Dishes</div>
		<div id="carousel">
			<!-- Carousel items will be dynamically added here -->
		</div>
	</div>

	<!-- Bottom Navbar -->
	<div id="bottom-navbar">
		<a id="back-button">&#8592; Back</a>
		<div id="logo">SeeEatEnjoy!</div>
	</div>

	<script>
		var THREEx = THREEx || {};
		THREEx.wrapperElement = null;
		THREEx.setWrapperElement = function(wrapperEl, video) {
			THREEx.wrapperElement = wrapperEl;
			wrapperEl.appendChild(video);
		};

		var scene, camera, renderer, clock, deltaTime, totalTime;
		var arToolkitSource, arToolkitContext;
		var markerRoot1;
		var currentModel = null; // Track the currently loaded model

		// List of dishes with their image names
		const dishes = [
			{ name: "Chicken Tikka", image: "chicken-tikka.jpg" },
			{ name: "Pasta Alfredo", image: "pasta-alfredo.jpg" },
			{ name: "Grilled Salmon", image: "grilled-salmon.jpg" },
			{ name: "Beef Steak", image: "beef-steak.jpg" },
			{ name: "Vegetable Curry", image: "vegetable-curry.jpg" }
		];

		// Function to dynamically add carousel items
		function populateCarousel() {
			const carousel = document.getElementById('carousel');
			dishes.forEach(dish => {
				const carouselItem = document.createElement('div');
				carouselItem.classList.add('carousel-item');

				const img = document.createElement('img');
				img.src = `images/${dish.image}`; // Path to images folder
				img.alt = dish.name;

				const p = document.createElement('p');
				p.textContent = dish.name;

				carouselItem.appendChild(img);
				carouselItem.appendChild(p);
				carousel.appendChild(carouselItem);
			});
		}

		// Initialize the carousel
		populateCarousel();

		initialize();
		animate();

		function initialize() {
			scene = new THREE.Scene();

			let ambientLight = new THREE.AmbientLight(0xcccccc, 1.0);
			scene.add(ambientLight);

			camera = new THREE.Camera();
			scene.add(camera);

			renderer = new THREE.WebGLRenderer({
				antialias: true,
				alpha: true
			});
			renderer.setClearColor(new THREE.Color('lightgrey'), 0);
			renderer.setSize(window.innerWidth, window.innerHeight * 0.6); /* Adjusted for 10% increase */
			renderer.domElement.style.position = 'absolute';
			renderer.domElement.style.top = '0px';
			renderer.domElement.style.left = '0px';

			// Append the renderer to the wrapper
			const wrapper = document.getElementById('arjs-wrapper');
			wrapper.appendChild(renderer.domElement);

			clock = new THREE.Clock();
			deltaTime = 0;
			totalTime = 0;

			// Setup AR toolkit source and context
			arToolkitSource = new THREEx.ArToolkitSource({
				sourceType: 'webcam',
			});

			arToolkitSource.init(function onReady() {
				// Set the wrapper element and reparent the video
				THREEx.setWrapperElement(wrapper, arToolkitSource.domElement);
				onResize();
			});

			window.addEventListener('resize', function () {
				onResize();
			});

			arToolkitContext = new THREEx.ArToolkitContext({
				cameraParametersUrl: 'data/camera_para.dat',
				detectionMode: 'mono'
			});

			arToolkitContext.init(function onCompleted() {
				camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix());
			});

			// Setup marker root
			markerRoot1 = new THREE.Group();
			scene.add(markerRoot1);

			let markerControls1 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot1, {
				type: 'pattern',
				patternUrl: "data/hiro.patt",
			});

			// Add event listener to the dropdown menu
			const dropdownMenu = document.getElementById('dropdown-menu');
			dropdownMenu.addEventListener('change', function (event) {
				const selectedModel = event.target.value; // Get the selected model name
				loadModel(selectedModel); // Load the selected model
			});

			// Load the initial model (e.g., fish)
			loadModel('fish');
		}

		function loadModel(modelName) {
			// Remove the current model if it exists
			if (currentModel) {
				markerRoot1.remove(currentModel);
				currentModel = null;
			}

			// Instantiate a loader
			const loader = new THREE.GLTFLoader();

			// Optional: Provide a DRACOLoader instance to decode compressed mesh data
			const dracoLoader = new THREE.DRACOLoader();
			dracoLoader.setDecoderPath('https://cdn.jsdelivr.net/npm/three@0.146/examples/js/libs/draco/');
			loader.setDRACOLoader(dracoLoader);

			// Load a GLB resource
			loader.load(
				`models/${modelName}.glb`, // Resource URL
				function (gltf) {
					currentModel = gltf.scene;
					currentModel.scale.set(0.25, 0.25, 0.25); // Adjust scale as needed
					currentModel.position.y = 0.25; // Adjust position
					markerRoot1.add(currentModel); // Add the model to the marker
				},
				function (xhr) {
					console.log((xhr.loaded / xhr.total * 100) + '% loaded');
				},
				function (error) {
					console.error('An error happened while loading the model:', error);
				}
			);
		}

		function update() {
			if (arToolkitSource.ready !== false)
				arToolkitContext.update(arToolkitSource.domElement);
		}

		function render() {
			renderer.render(scene, camera);
		}

		function animate() {
			requestAnimationFrame(animate);
			deltaTime = clock.getDelta();
			totalTime += deltaTime;
			update();
			render();
		}

		function onResize() {
			const cameraSection = document.getElementById('camera-section');
			const wrapper = document.getElementById('arjs-wrapper');
			wrapper.style.width = cameraSection.clientWidth + 'px';
			wrapper.style.height = cameraSection.clientHeight + 'px';
			renderer.setSize(cameraSection.clientWidth, cameraSection.clientHeight);
			arToolkitSource.onResizeElement(); // Updated function
			arToolkitSource.copyElementSizeTo(renderer.domElement); // Updated function
			if (arToolkitContext.arController !== null) {
				arToolkitSource.copyElementSizeTo(arToolkitContext.arController.canvas); // Updated function
			}
		}
	</script>
</body>
</html>
